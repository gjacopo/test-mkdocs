
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="SSA test">
      
      
      
        <meta name="author" content="DIGIT D1">
      
      
      <link rel="shortcut icon" href="https://github.com/ec-europa/digit-dataplatform/blob/master/docs/docs/img/favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.3">
    
    
      
        <title>Integration of `R` in `KNIME` for Anomaly Detection (impl. the `tsoutlier R` package) - Self-service User Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.3b61ea93.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.39b8e14a.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#integration-of-r-in-knime-for-anomaly-detection-impl-the-tsoutlier-r-package" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../.." title="Self-service User Documentation" class="md-header-nav__button md-logo" aria-label="Self-service User Documentation">
      
  <img src="https://github.com/ec-europa/digit-dataplatform/blob/master/docs/docs/img/ec_logo.jpeg" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            Self-service User Documentation
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Integration of `R` in `KNIME` for Anomaly Detection (impl. the `tsoutlier R` package)
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/gjacopo/test-mkdocs/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    gjacopo/test-mkdocs
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Self-service User Documentation" class="md-nav__button md-logo" aria-label="Self-service User Documentation">
      
  <img src="https://github.com/ec-europa/digit-dataplatform/blob/master/docs/docs/img/ec_logo.jpeg" alt="logo">

    </a>
    Self-service User Documentation
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/gjacopo/test-mkdocs/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    gjacopo/test-mkdocs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      



  <li class="md-nav__item">
    <a href="../../.." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="../../../about/" class="md-nav__link">
      About
    </a>
  </li>

    
      
      
      


  


  
  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Tools
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Tools" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  


  
  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1" checked>
    
    <label class="md-nav__link" for="nav-3-1">
      KNIME
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="KNIME" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        <span class="md-nav__icon md-icon"></span>
        KNIME
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Integration of `R` in `KNIME` for Anomaly Detection (impl. the `tsoutlier R` package)
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Integration of `R` in `KNIME` for Anomaly Detection (impl. the `tsoutlier R` package)
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#outlier-detection" class="md-nav__link">
    Outlier detection
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dataset-information" class="md-nav__link">
    Dataset information
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation" class="md-nav__link">
    Implementation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-story" class="md-nav__link">
    User Story
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#softwaredata-resources" class="md-nav__link">
    Software/data resources
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#outlier-detection" class="md-nav__link">
    Outlier detection
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dataset-information" class="md-nav__link">
    Dataset information
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation" class="md-nav__link">
    Implementation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-story" class="md-nav__link">
    User Story
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#softwaredata-resources" class="md-nav__link">
    Software/data resources
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/gjacopo/test-mkdocs/edit/master/docs/tools/KNIME/anomaly-detection-R.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="integration-of-r-in-knime-for-anomaly-detection-impl-the-tsoutlier-r-package">Integration of <code>R</code> in <code>KNIME</code> for Anomaly Detection (impl. the <code>tsoutlier R</code> package)</h1>
<p>(Material prepared by <a href="mailto:Emmanouil.MARAGKOUDAKIS@ext.ec.europa.eu">E.Maragkoudakis</a>)</p>
<h2 id="introduction">Introduction</h2>
<p>The aim of this workflow is to demonstrate how one can use <code>R</code> code to perform anomaly detection, using the <code>tsoutliers R</code> package and
integrate it to <code>KNIME</code>, in order to help identifying outliers in a dataset and either replace them with an averaging value or remove them. 
The data used for the task-at-hand is the <em>"Carbon dioxide (CO₂) emissions from the burning of fossil fuels for energy and cement production"</em>
dataset found in <a href="https://ourworldindata.org/grapher/co-emissions-per-capita">here</a> and <a href="https://datamotus.com/2019-11-15-Outlier-Detection_files/co-emissions-per-capita.csv">there</a>.</p>
<h2 id="outlier-detection">Outlier detection</h2>
<p>Time series data often undergo sudden changes that alter the dynamics of the data transitory or permanently. 
These changes are typically non systematic and cannot be captured by standard time series models. That's why they are known as exogenous 
or outlier effects. Detecting outliers is important because they have an impact on the selection of the model, the estimation of 
parameters and, consequently, on forecasts.</p>
<p>Following the approach described in Chen &amp; Liu (see <a href="#references">references</a>), an automatic procedure for detection of outliers in time series is implemented in the package <code>tsoutliers</code>. 
The procedure may in turn be run along with the automatic ARIMA model selection strategy available in the package <code>forecast</code>.</p>
<p>The function <code>tso</code> is the main interface for the automatic procedure. The functions <code>locate.outliers.oloop</code> and <code>remove.outliers</code> 
implement respectively the first and second stages of the procedure. In practice, the user may stick to use the function <code>tso</code>.</p>
<p>Although the purpose of the package is to provide an automatic procedure, the implementation allows the user to do a manual inspection 
of each step of the procedure. Thus, the package is also useful to track the behaviour of the procedure and come up with ideas for 
possible improvements or enhancements.</p>
<p>The functions <code>locate.outliers.oloop</code> and <code>remove.outliers</code> implement the major steps of the procedure. <code>tso</code> is the main interface to 
the automatic procedure. All the options at any stage of the procedure can be defined through the arguments passed to tso. Despite the 
user may stick to use the function tso, other functions called by this main interface are exported in the namespace of the package. They 
are helpful for debugging and allow the interested user to more easily track each step of the procedure.</p>
<p>Information supplemental to these help pages is given in the document that is provided with the package ("tsoutliers/inst/doc/" in the 
source files, see also <a href="#references">references</a>).</p>
<h2 id="dataset-information">Dataset information</h2>
<p>Human emissions of carbon dioxide and other greenhouse gases – are a primary driver of climate change – and present one of the world's 
most pressing challenges. This link between global temperatures and greenhouse gas concentrations – especially CO2 – has been true 
throughout Earth's history.</p>
<p>To set the scene, let’s look at how the planet has warmed. In the chart we see the global average temperature relative to the average 
of the period between 1961 and 1990.</p>
<p>The red line represents the average annual temperature trend through time, with upper and lower confidence intervals shown in light grey.</p>
<p>We see that over the last few decades, global temperatures have risen sharply — to approximately 0.7℃ higher than our 1961-1990 baseline. 
When extended back to 1850, we see that temperatures then were a further 0.4℃ colder than they were in our baseline. Overall, this would
amount to an average temperature rise of 1.1℃.</p>
<p>Because there are small year-to-year fluctuations in temperature, the specific temperature increase depends on what year we assume to be 
're-industrial' and the end year we are measuring from. But overall, this temperature rise is in the range of 1 to 1.2℃.</p>
<h2 id="implementation">Implementation</h2>
<p>The architecture of the workflow is depicted below:</p>
<!-- ![workflow](imgs/image2020-12-23_13-58-51.png) -->
<p><img src="../imgs/image2020-12-23_13-58-51.png" alt="drawing" width="750"/></p>
<p>You can download the workflow from here (<em>TO BE ADDED</em>).</p>
<h2 id="user-story">User Story</h2>
<p>The country code and the starting year is inserted by the user using a <code>KNIME</code> component. Data is filtered according to the preferences of 
the user and the CO2 emission column is sent to <code>R</code> code in order for the tso function to execute, plot the anomalies and extract the 
indices of the outliers. 
Since <code>tso</code> starts the numbering from 1 and the original data have other indices, we ask <code>KNIME</code> to create a new <code>"RowID"</code>, we uniform the 
row <code>id</code> code for the original and the anomalous data and using the inner join node we extract the year that corresponds to all anomalies.</p>
<p><strong>Source data:</strong></p>
<!-- ![source](imgs/image2020-12-23_14-14-50.png) -->
<p><img src="../imgs/image2020-12-23_14-14-50.png" alt="drawing" width="200"/></p>
<p><strong>Use-selection in <code>KNIME</code> component:</strong></p>
<!-- ![selection](imgs/image2020-12-23_14-14-7.png) -->
<p><img src="../imgs/image2020-12-23_14-14-7.png" alt="drawing" width="500"/></p>
<p><strong>R code for outlier detection:</strong></p>
<pre><code class="language-R">library(tsoutliers)
rframe &lt;- knime.in
dat.ts&lt;- ts(rframe,frequency=3)
data.ts.outliers &lt;- tso(dat.ts)
</code></pre>
<p><strong>Plot of the anomalies:</strong></p>
<!-- ![anomalies](imgs/image2020-12-23_14-12-48.png) -->
<p><img src=../"imgs/image2020-12-23_14-12-48.png" alt="drawing" width="400"/></p>
<p><strong>Outliers list:</strong></p>
<!-- ![outliers list](imgs/image2020-12-23_14-16-27.png) -->
<p><img src="../imgs/image2020-12-23_14-16-27.png" alt="drawing" width="400"/></p>
<p><strong>Outliers joined with the initial dataset:</strong></p>
<!-- ![outliers](imgs/image2020-12-23_14-17-43.png) -->
<p><img src="../imgs/image2020-12-23_14-17-43.png" alt="drawing" width="400"/></p>
<h2 id="softwaredata-resources">Software/data resources</h2>
<ul>
<li>More information regarding data on <a href="https://ourworldindata.org/co2-and-other-greenhouse-gas-emissions">CO₂ emission and-other-greenhouse-gas-emissions</a>
 and <a href="https://ourworldindata.org/grapher/co-emissions-per-capita">co-emissions-per-capita</a>, including 
<a href="https://datamotus.com/2019-11-15-Outlier-Detection_files/co-emissions-per-capita.csv">Carbon dioxide (CO₂) emissions from the burning of fossil fuels for energy and cement production</a></li>
<li><code>TSoutliers</code> <a href="https://cran.r-project.org/web/packages/tsoutliers/index.html">CRAN package</a> and 
<a href="https://cran.r-project.org/web/packages/tsoutliers/tsoutliers.pdf">manual</a>.</li>
</ul>
<h2 id="references">References<a id="references"></a></h2>
<ul>
<li>Chen, C. and Liu, L.-M. (1993): <strong>Joint estimation of model parameters and outlier effects in time series</strong>, 
<em>Journal of the American Statistical Association</em>, 88(421):284-297, doi:<a href="https://doi.org/10.1080/01621459.1993.10594321">10.1080/01621459.1993.10594321</a>.</li>
<li>Chen, C. and Liu, L.-M. (1993): <strong>Forecasting time series with outliers</strong>,  <em>Journal of Forecasting</em>, 
12(1):13-35, doi:<a href="https://doi.org/10.1002/for.3980120103">10.1002/for.3980120103</a>.</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../../../about/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                About
              </div>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/vendor.08c56446.min.js"></script>
      <script src="../../../assets/javascripts/bundle.6ced434e.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../../..",
          features: [],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.8c7e0a7e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>